このコードでは、五回substr関数を呼び出すが、その度にmallocを用いて関数内の局所変数のための領域が確保されていて、しかも開放されていない。これでは、特に入力された文字列がかなり長い場合、かなりのメモリが消費されてしまう。これを防ぐためには、どこかで確保したメモリを開放してやらなければならない。
substr関数を使わず、main関数の内部にsubstr関数を埋め込んでしまうのが良いかと思われる。そして、substr関数内のbufにあたるものを、s[i]を出力したのちにfreeしてやれば、解決すると思われる。
あるいは、substr関数のbuf + iより前をsubstr関数内でfreeしてやったのち、s[i]を出力した直後にs[i]をfreeしてやるのも手かもしれないが、こちらは実現の仕方があまりよく分からない。